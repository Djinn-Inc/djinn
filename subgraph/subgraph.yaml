# NOTE: Contract addresses are placeholders. After deploying contracts (see scripts/deploy_base.sh),
# run: ./scripts/update_subgraph.sh --signal 0x... --escrow 0x... [...]
# Also set startBlock to the deployment block number for fast initial sync.
specVersion: 1.0.0
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql
dataSources:
  # --- SignalCommitment ---
  - kind: ethereum
    name: SignalCommitment
    network: base-sepolia
    source:
      address: "0x83F38eA8B66634643E6FEC8F18848DAa0c86F6DE"
      abi: SignalCommitment
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Signal
        - Genius
        - ProtocolStats
      abis:
        - name: SignalCommitment
          file: ./abis/SignalCommitment.json
      eventHandlers:
        - event: SignalCommitted(indexed uint256,indexed address,string,uint256,uint256,uint256,uint256)
          handler: handleSignalCommitted
        - event: SignalVoided(indexed uint256,indexed address)
          handler: handleSignalVoided
        - event: SignalStatusUpdated(indexed uint256,uint8)
          handler: handleSignalStatusUpdated
      file: ./src/signal-commitment.ts

  # --- Escrow ---
  - kind: ethereum
    name: Escrow
    network: base-sepolia
    source:
      address: "0x06e6d123DD2474599579B648dd56973120CcEFcA"
      abi: Escrow
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Purchase
        - Idiot
        - Genius
        - Signal
        - ProtocolStats
      abis:
        - name: Escrow
          file: ./abis/Escrow.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,uint256)
          handler: handleWithdrawn
        - event: SignalPurchased(indexed uint256,indexed address,uint256,uint256,uint256,uint256,uint256)
          handler: handleSignalPurchased
        - event: Refunded(indexed address,indexed address,uint256,uint256)
          handler: handleRefunded
        - event: OutcomeUpdated(indexed uint256,uint8)
          handler: handleOutcomeUpdated
      file: ./src/escrow.ts

  # --- Collateral ---
  - kind: ethereum
    name: Collateral
    network: base-sepolia
    source:
      address: "0x06AAfF8643e99042f86f1EC93ED8A8BD36d6D9E7"
      abi: Collateral
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - CollateralPosition
        - Genius
        - ProtocolStats
      abis:
        - name: Collateral
          file: ./abis/Collateral.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleCollateralDeposited
        - event: Withdrawn(indexed address,uint256)
          handler: handleCollateralWithdrawn
        - event: Locked(indexed uint256,indexed address,uint256)
          handler: handleCollateralLocked
        - event: Released(indexed uint256,indexed address,uint256)
          handler: handleCollateralReleased
        - event: Slashed(indexed address,uint256,indexed address)
          handler: handleCollateralSlashed
      file: ./src/collateral.ts

  # --- Account ---
  - kind: ethereum
    name: Account
    network: base-sepolia
    source:
      address: "0x7f5700896051f4af0F597135A39a6D9D24F8B2af"
      abi: Account
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Account
        - Genius
        - Idiot
      abis:
        - name: Account
          file: ./abis/Account.json
      eventHandlers:
        - event: PurchaseRecorded(indexed address,indexed address,uint256,uint256)
          handler: handlePurchaseRecorded
        - event: OutcomeRecorded(indexed address,indexed address,uint256,uint8)
          handler: handleOutcomeRecorded
        - event: NewCycleStarted(indexed address,indexed address,uint256)
          handler: handleNewCycleStarted
        - event: SettledChanged(indexed address,indexed address,bool)
          handler: handleSettledChanged
      file: ./src/account.ts

  # --- Audit ---
  - kind: ethereum
    name: Audit
    network: base-sepolia
    source:
      address: "0x4ca56d7e1D10Ec78C26C98a39b17f83Ca85b68c3"
      abi: Audit
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - AuditResult
        - Genius
        - Idiot
        - Account
        - ProtocolStats
      abis:
        - name: Audit
          file: ./abis/Audit.json
      eventHandlers:
        - event: AuditSettled(indexed address,indexed address,uint256,int256,uint256,uint256,uint256)
          handler: handleAuditSettled
        - event: EarlyExitSettled(indexed address,indexed address,uint256,int256,uint256)
          handler: handleEarlyExitSettled
      file: ./src/audit.ts

  # --- CreditLedger ---
  - kind: ethereum
    name: CreditLedger
    network: base-sepolia
    source:
      address: "0x09de6d7B81ED73707364ee772eAdA7c191c8a4FC"
      abi: CreditLedger
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - CreditBalance
        - Idiot
        - ProtocolStats
      abis:
        - name: CreditLedger
          file: ./abis/CreditLedger.json
      eventHandlers:
        - event: CreditsMinted(indexed address,uint256)
          handler: handleCreditsMinted
        - event: CreditsBurned(indexed address,uint256)
          handler: handleCreditsBurned
      file: ./src/credit-ledger.ts

  # --- TrackRecord ---
  - kind: ethereum
    name: TrackRecord
    network: base-sepolia
    source:
      address: "0xd3FA108474eb4EfC79649a17472c5F7d729Ac08b"
      abi: TrackRecord
      startBlock: 37892788
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - TrackRecordProof
        - Genius
        - ProtocolStats
      abis:
        - name: TrackRecord
          file: ./abis/TrackRecord.json
      eventHandlers:
        - event: TrackRecordSubmitted(indexed uint256,indexed address,uint256,uint256,uint256,uint256,uint256,uint256,bytes32)
          handler: handleTrackRecordSubmitted
      file: ./src/track-record.ts
