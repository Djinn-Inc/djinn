# NOTE: Contract addresses are placeholders. After deploying contracts (see scripts/deploy_base.sh),
# run: ./scripts/update_subgraph.sh --signal 0x... --escrow 0x... [...]
# Also set startBlock to the deployment block number for fast initial sync.
specVersion: 1.0.0
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql
dataSources:
  # --- SignalCommitment ---
  - kind: ethereum
    name: SignalCommitment
    network: base-sepolia
    source:
      address: "0x4675613f4aC6329D294605a56f2AAf04B0cc1f7d"
      abi: SignalCommitment
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Signal
        - Genius
        - ProtocolStats
      abis:
        - name: SignalCommitment
          file: ./abis/SignalCommitment.json
      eventHandlers:
        - event: SignalCommitted(indexed uint256,indexed address,string,uint256,uint256,uint256,uint256)
          handler: handleSignalCommitted
        - event: SignalVoided(indexed uint256,indexed address)
          handler: handleSignalVoided
        - event: SignalStatusUpdated(indexed uint256,uint8)
          handler: handleSignalStatusUpdated
      file: ./src/signal-commitment.ts

  # --- Escrow ---
  - kind: ethereum
    name: Escrow
    network: base-sepolia
    source:
      address: "0x83DcE21BA5875433Bc46e5eAC91e2B15cfA5B002"
      abi: Escrow
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Purchase
        - Idiot
        - Genius
        - Signal
        - ProtocolStats
      abis:
        - name: Escrow
          file: ./abis/Escrow.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleDeposited
        - event: Withdrawn(indexed address,uint256)
          handler: handleWithdrawn
        - event: SignalPurchased(indexed uint256,indexed address,uint256,uint256,uint256,uint256,uint256)
          handler: handleSignalPurchased
        - event: Refunded(indexed address,indexed address,uint256,uint256)
          handler: handleRefunded
        - event: OutcomeUpdated(indexed uint256,uint8)
          handler: handleOutcomeUpdated
      file: ./src/escrow.ts

  # --- Collateral ---
  - kind: ethereum
    name: Collateral
    network: base-sepolia
    source:
      address: "0x436b9246F5eE53835df6AA68CdEeaE02514C0De6"
      abi: Collateral
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - CollateralPosition
        - Genius
        - ProtocolStats
      abis:
        - name: Collateral
          file: ./abis/Collateral.json
      eventHandlers:
        - event: Deposited(indexed address,uint256)
          handler: handleCollateralDeposited
        - event: Withdrawn(indexed address,uint256)
          handler: handleCollateralWithdrawn
        - event: Locked(indexed uint256,indexed address,uint256)
          handler: handleCollateralLocked
        - event: Released(indexed uint256,indexed address,uint256)
          handler: handleCollateralReleased
        - event: Slashed(indexed address,uint256,indexed address)
          handler: handleCollateralSlashed
      file: ./src/collateral.ts

  # --- Account ---
  - kind: ethereum
    name: Account
    network: base-sepolia
    source:
      address: "0x8fF0e9aAAb1206eb2C6087deE264e5EFB3EaDB4B"
      abi: Account
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - Account
        - Genius
        - Idiot
      abis:
        - name: Account
          file: ./abis/Account.json
      eventHandlers:
        - event: PurchaseRecorded(indexed address,indexed address,uint256,uint256)
          handler: handlePurchaseRecorded
        - event: OutcomeRecorded(indexed address,indexed address,uint256,uint8)
          handler: handleOutcomeRecorded
        - event: NewCycleStarted(indexed address,indexed address,uint256)
          handler: handleNewCycleStarted
        - event: SettledChanged(indexed address,indexed address,bool)
          handler: handleSettledChanged
      file: ./src/account.ts

  # --- Audit ---
  - kind: ethereum
    name: Audit
    network: base-sepolia
    source:
      address: "0x18b30e757f1bfddd8728deec7ea4b7463939343d"
      abi: Audit
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - AuditResult
        - Genius
        - Idiot
        - Account
        - ProtocolStats
      abis:
        - name: Audit
          file: ./abis/Audit.json
      eventHandlers:
        - event: AuditSettled(indexed address,indexed address,uint256,int256,uint256,uint256,uint256)
          handler: handleAuditSettled
        - event: EarlyExitSettled(indexed address,indexed address,uint256,int256,uint256)
          handler: handleEarlyExitSettled
      file: ./src/audit.ts

  # --- CreditLedger ---
  - kind: ethereum
    name: CreditLedger
    network: base-sepolia
    source:
      address: "0x1a3174C715D832b865269fD44beBd742922BC017"
      abi: CreditLedger
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - CreditBalance
        - Idiot
        - ProtocolStats
      abis:
        - name: CreditLedger
          file: ./abis/CreditLedger.json
      eventHandlers:
        - event: CreditsMinted(indexed address,uint256)
          handler: handleCreditsMinted
        - event: CreditsBurned(indexed address,uint256)
          handler: handleCreditsBurned
      file: ./src/credit-ledger.ts

  # --- TrackRecord ---
  - kind: ethereum
    name: TrackRecord
    network: base-sepolia
    source:
      address: "0xD1dA1E9258B042b8309A1278BaACe16B1D99C423"
      abi: TrackRecord
      startBlock: 37786979
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.9
      language: wasm/assemblyscript
      entities:
        - TrackRecordProof
        - Genius
        - ProtocolStats
      abis:
        - name: TrackRecord
          file: ./abis/TrackRecord.json
      eventHandlers:
        - event: TrackRecordSubmitted(indexed uint256,indexed address,uint256,uint256,uint256,uint256,uint256,uint256,bytes32)
          handler: handleTrackRecordSubmitted
      file: ./src/track-record.ts
